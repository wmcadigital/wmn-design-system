name: 'Branch guard'

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  can-merge-to-branch:
    name: Can merge to branch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Allowed to merge to master
        if: "github.base_ref == 'master' && !(startsWith(github.head_ref, 'release'))"
        run: |
          echo "";
          echo "head branch is: $GITHUB_HEAD_REF";
          echo "base branch is: $GITHUB_BASE_REF";
          echo "*****";
          echo "::error::Only release branch is allowed to merge to master";
          exit 1;
