{% macro wmndsFindTimetableWidget(params) %}

{# Imports of components #}
{% from "wmnds/components/content-card/_content-card.njk" import wmndsContentCard %}
{% from "wmnds/components/form-elements/text-input/_text-input.njk" import wmndsTextInput %}
{% from "wmnds/components/button/_button.njk" import wmndsButton %}
{% from "wmnds/components/loader/_loader.njk" import wmndsLoader %}
{% from "wmnds/patterns/autocomplete/_autocomplete.njk" import wmndsAutocomplete %}

{# Set params #}
{% set formTitle = params.formTitle if params.formTitle else "Find timetable" %}
{% set contentText = params.contentText if params.contentText else "Select your transport mode" %}
{% set contentHTML = params.contentHTML if params.contentHTML else null %}
{% set _content = contentHTML | safe if contentHTML else contentText %} {# change content based on what user has input #}
{% set isOpen = " wmnds-is--open" if params.isOpen %}
{% set isBusActive = " wmnds-is--active" if params.showSuggestions %}
{% set isTramActive = " wmnds-is--active" if params.showSuggestions !== true and params.isOpen %}
{% set suffix = "--showing-suggestions" if params.showSuggestions %}
{% set placeholder = "" if params.placeholder else "Enter a service number" %}



<div style="max-width: 448px">

    <div class="wmnds-find-timetable-widget {{isOpen}}">

        {% call wmndsContentCard() %}
            <div class="wmnds-p-md">

                <h2>{{formTitle}}</h2>
                <div class="wmnds-find-timetable__content">
                    {{_content}}
                </div>

                <form class="wmnds-find-timetable-widget__form">

                    <div class="wmnds-find-timetable-widget__travel-modes wmnds-grid wmnds-grid--spacing-3-sm wmnds-m-t-sm">

                        <div class="wmnds-col-1-3">
                            {{
                                wmndsButton({
                                    iconLeft: "modes-isolated-bus",
                                    contentText: "Bus",
                                    type: "mode",
                                    classes: ("wmnds-col-1 wmnds-m-b-sm " + isBusActive)
                                })
                            }}
                        </div>
                        <div class="wmnds-col-1-3">
                            {{
                                wmndsButton({
                                    iconLeft: "modes-isolated-metro",
                                    contentText: "Tram",
                                    type: "mode",
                                    classes: ("wmnds-col-1 wmnds-m-b-sm " + isTramActive)
                                })
                            }}
                        </div>
                        <div class="wmnds-col-1-3">
                            {{
                                wmndsButton({
                                    iconLeft: "modes-isolated-rail",
                                    contentText: "Train",
                                    type: "mode",
                                    classes:"wmnds-col-1 wmnds-m-b-sm"
                                })
                            }}
                        </div>
                    </div>

                    {% if params.isOpen %}
                    <div class="wmnds-find-timetable-widget__services">
                        {% if params.showSuggestions %}
                            {{
                                wmndsAutocomplete({
                                    label: {
                                        contentText: 'Bus Services',
                                        classes: 'wmnds-screenreaders-only'
                                    },
                                    id: ("bus-service"+ suffix),
                                    placeholder: 'Enter a service number',
                                    loading: false,
                                    query: "X15",
                                    showSuggestions: params.showSuggestions,
                                    textSuggestions: false,
                                    required: true,
                                    formGroup: {
                                        classes: 'wmnds-m-b-md'
                                    }
                                })
                            }}

                        {% else %}
                    
                            {{
                                wmndsTextInput({
                                    id: ("services"+ suffix),
                                    name: "services",
                                    label: {
                                        contentText: 'Services',
                                        classes: 'wmnds-screenreaders-only'
                                    },
                                    placeholder: 'Enter a service number',
                                    required: true,
                                    formGroup: {
                                        classes: 'wmnds-m-b-md'
                                    }
                                })
                            }}

                        {% endif %}
                    </div>
                    {% endif %}

                </form>
            </div>
        {% endcall %}

    </div>
</div>


{% endmacro %}